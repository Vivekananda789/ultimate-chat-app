<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat App</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<header>
    <h1>Welcome to the Chat App</h1>
</header>

<div class="container">
    <div id="chat-box"></div>

    <div id="users-online">
        <h3>Online Users: <span id="user-count">0</span></h3>
        <ul id="user-list"></ul>
    </div>

    <form id="chat-form">
        <input type="text" id="username" placeholder="Enter your name" required>
        <input type="text" id="room" placeholder="Enter room (optional)">
        <button type="button" onclick="joinChat()">Join Chat</button>
    </form>

    <form id="message-form" style="display: none;">
        <input type="text" id="message" placeholder="Type your message">
        <button type="submit">Send</button>
    </form>
</div>

<footer>
    <p>Created by Vivekananda</p>
</footer>

<script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
<script>
    const socket = io();
    let currentRoom = 'general';
    let currentUser = '';

    function joinChat() {
        currentUser = document.getElementById('username').value;
        currentRoom = document.getElementById('room').value || 'general';

        socket.emit('join', { username: currentUser, room: currentRoom });

        document.getElementById('chat-form').style.display = 'none';
        document.getElementById('message-form').style.display = 'flex';
    }

    socket.on('chat_message', (msg) => {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<p><b>${msg.username}:</b> ${msg.text}</p>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on('server_message', (msg) => {
        const chatBox = document.getElementById('chat-box');
        chatBox.innerHTML += `<p class="server-message"><b>Server:</b> ${msg.msg}</p>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    socket.on('update_users', (data) => {
        document.getElementById('user-count').innerText = data.count;
        const userList = document.getElementById('user-list');
        userList.innerHTML = '';
        data.users.forEach(user => {
            userList.innerHTML += `<li>${user}</li>`;
        });
    });

    document.getElementById('message-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const message = document.getElementById('message').value;
        if (message) {
            socket.emit('message', { username: currentUser, text: message, room: currentRoom });
            document.getElementById('message').value = '';
        }
    });
</script>

</body>
</html>
