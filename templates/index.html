<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Chat App</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
</head>
<body>

<header>
    <h1>Welcome to the Chat App</h1>
</header>

<div class="container">
    <div id="users-online">
        <h3>Online Users: <span id="online-count">0</span></h3>
        <ul id="user-list"></ul>
    </div>

    <div id="chat-box"></div>

    <form id="message-form">
        <input type="text" id="message-input" placeholder="Type your message">
        <button type="submit">Send</button>
        <button id="exit-btn" type="button">Exit Chat</button>
    </form>
</div>

<footer>
    Created by Vivekananda
</footer>

<script>
    const socket = io();
    const username = prompt("Enter your name") || "Anonymous";
    const room = prompt("Enter room (optional)") || "general";

    socket.emit('join', { username, room });

    const chatBox = document.getElementById('chat-box');
    const messageForm = document.getElementById('message-form');
    const messageInput = document.getElementById('message-input');
    const onlineCount = document.getElementById('online-count');
    const userList = document.getElementById('user-list');

    socket.on('user_joined', (data) => {
        chatBox.innerHTML += `<div class="message"><strong>Server:</strong> ${data.username} has joined the room. ${data.timestamp}</div>`;
        updateOnlineUsers(data.online_users);
    });

    socket.on('user_left', (data) => {
        chatBox.innerHTML += `<div class="message"><strong>Server:</strong> ${data.username} has left the chat.</div>`;
        updateOnlineUsers(data.online_users);
    });

    socket.on('message', (msg) => {
        chatBox.innerHTML += `<div class="message">${msg}</div>`;
        chatBox.scrollTop = chatBox.scrollHeight;
    });

    messageForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const msg = messageInput.value;
        if (msg) {
            socket.send(`<strong>${username}:</strong> ${msg}`);
            messageInput.value = '';
        }
    });

    document.getElementById('exit-btn').addEventListener('click', () => {
        socket.emit('exit', { username });
        alert("You have left the chat.");
        window.location.reload();
    });

    function updateOnlineUsers(users) {
        onlineCount.innerText = users.length;
        userList.innerHTML = users.map(user => `<li>${user}</li>`).join('');
    }
</script>

</body>
</html>
